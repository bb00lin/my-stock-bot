name: Test Project Cleaner (Manual)

on:
  workflow_dispatch: # 這是關鍵：允許您手動點按鈕觸發

jobs:
  test_cleaner:
    runs-on: ubuntu-latest

    steps:
    # 1. 下載程式碼
    - name: Checkout code
      uses: actions/checkout@v3

    # 2. 設定 Python 環境
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    # 3. 安裝套件 (注意這裡多安裝了 beautifulsoup4 和 lxml)
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install atlassian-python-api beautifulsoup4 requests lxml

    # 4. 執行清理腳本 (使用原本的 Secrets)
    - name: Run Cleaner Script
      env:
        CONF_URL: ${{ secrets.CONF_URL }}
        CONF_USER: ${{ secrets.CONF_USER }}
        CONF_PASS: ${{ secrets.CONF_PASS }}
      run: |
        python confluence_cleaner.py
